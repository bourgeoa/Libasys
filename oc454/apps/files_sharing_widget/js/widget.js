/**
 * ownCloud - Picture Widget
 *
 * @author Sebastian Doell
 * @copyright 2012 Sebastian Doell <sebastian.doell ad libasys dot de>
 *
 *
 */
(function(){var d;if(window.jQuery===undefined||window.jQuery.fn.jquery!=="1.8.2"){var e=document.createElement("script");e.setAttribute("type","text/javascript");e.setAttribute("src",ownWidgetOptions.path+ownWidgetOptions.appspath+"/files_sharing_widget/js/jquery-pack.min.js");if(e.readyState){e.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){b()}}}else{e.onload=b}(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e)}else{d=window.jQuery;a()}function b(){d=window.jQuery.noConflict(true);a()}function f(g){g=(g+"").toString();return encodeURIComponent(g).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function a(){d(document).ready(function(g){if(ownWidgetOptions.showButtonLink!=undefined){c.prepareExternLink(ownWidgetOptions)}else{if(g("#ownWidget-container").length>0){c.init(ownWidgetOptions)}}})}var c={init:function(g){var h={crypt:"",path:"",appspath:"apps",showButtonLink:"",customThumbHeight:"",customThumbpPage:"",display:"",fbAppid:"",modal:true,cssAddWidget:{width:1000,height:560},cssAddButton:{top:20,left:20},buttonlabel:"Fotogalerie"};this.options=d.extend(true,h,g);this.loadCssFile();this.imageSlide=[];this.loadPage="";this.widgetContainer=d("#ownWidget-container");this.firstShow=true;if(this.options.fbAppid!=""){this.loginToFacebookApp()}if(this.options.display=="hidden"){this.createShowButton()}else{this.showWidget()}this.initSupersized()},prepareExternLink:function(h){var g=this;if(h.showButtonLink!=""){d("#"+h.showButtonLink).click(function(){clearTimeout(i);var i=setTimeout(function(){g.init(h)},500)})}},loadCssFile:function(){if(d("#ownWidgetCss").length<1){d("<link>",{id:"ownWidgetCss",rel:"stylesheet",type:"text/css",href:this.options.path+this.options.appspath+"/files_sharing_widget/css/widget.css"}).appendTo("head")}},createShowButton:function(){self=this;this.widgetContainer.hide();if(this.options.modal){this.overlay=d('<div id="ownWidget-overlayWid"></div>').appendTo("body")}this.addWidgetControls();var g=d('<div id="ownWidget-displayButton">'+this.options.buttonlabel+"</div>");g.css(this.options.cssAddButton);g.appendTo("body");g.click(function(){if(self.options.modal){self.overlay.height(d(window).height());self.overlay.width(d(window).width());self.overlay.animate({opacity:0.5},500,function(){self.loadData()})}else{self.loadData()}})},showWidget:function(){this.widgetContainer.hide();this.addWidgetControls();this.loadData()},addWidgetControls:function(){var g=this;if(this.options.display=="hidden"){var i=d('<div id="ownWidget-closeButton" style="cursor:pointer;">X</div>');this.widgetContainer.prepend(i)}this.widgetContainer.prepend('<div id="ownWidget-output" class="jcarousel"></div>');var h=d('<div id="ownWidget-header"></div><div id="SlideShowButton">Slideshow</div>');this.widgetContainer.prepend(h);d("#SlideShowButton").click(function(){g.widgetContainer.animate({opacity:"toggle"},500,function(){d("body").append("<div id='supersized-holder'></div>");d("#supersized-loader").remove();d("#supersized").remove();d("#supersized-holder").append("<div id='supersized-loader'></div><ul id='supersized' style=\"z-index:200;\"></ul>");d("#supersized").show();d("#slideshow-content").animate({opacity:"toggle"});d("a[rel=fancyArea]").each(function(j,k){g.imageSlide.push({image:k.href,title:k.title.replace(/</,"&lt;").replace(/>/,"&gt;"),thumb:k.children[0].src})});g.loadSupersized()})});d("#SlideShowButton").hide();if(this.options.display=="hidden"){i.click(function(){g.widgetContainer.animate({opacity:"toggle"},500,function(){if(g.options.modal){g.overlay.height(0);g.overlay.width(0)}g.firstShow=true;g.widgetContainer.hide()})})}},initMovingBox:function(){var g=this;var i=this.widgetContainer.height()-80;if(d("#albumPics").length>0){var i=this.widgetContainer.height()-210}d("#ownWidget-slider").movingBoxes({reducedSize:1,startPanel:1,hashTags:false,speed:700,fixedHeight:true,wrap:false,buildNav:true,navFormatter:function(){return"&#9679;"},preinit:function(){g.widgetContainer.prepend('<div id="ownWidget-Loader">&nbsp;</div>');d("#ownWidget-output").hide();d(".mb-wrapper").css({height:i})},initialized:function(k,j,h){d(".mb-scroll").height(i-20);d("#ownWidget-slider").height(i-20);d("#ownWidget-Loader").remove();d("#ownWidget-output").show()}})},loadData:function(){var h=this;var i="";if(this.options.customThumbHeight!=""){i="&cTh="+this.options.customThumbHeight}var g="";if(this.options.customThumbpPage!=""){g="&cTpP="+this.options.customThumbpPage}d.ajax({dataType:"jsonp",jsonp:"jsonp_callback",url:h.options.path+"widget.php?iToken="+f(h.options.crypt)+h.loadPage+i+g,success:function(j){d("#ownWidget-output").html("");d("#ownWidget-output").html(j.databack);d("#ownWidget-header").html(j.nav+" "+j.folder);if(d("#loginForm").length>0){d("#loginForm #iSubmit").click(function(k){k.preventDefault();h.loadPage="&password="+d("#password").val();h.loadData()})}d("#ownWidget-header .loadAlbum").each(function(k,l){d(l).click(function(){if(d(l).attr("title")==""){h.loadPage=""}else{h.loadPage="&path=/"+d(l).attr("title")}h.loadData()})});if(h.firstShow){h.widgetContainer.css(h.options.cssAddWidget);if(!h.options.cssAddWidget.top&&!h.options.cssAddWidget.left){h.widgetContainer.css({top:(d(window).height()/2)-(h.widgetContainer.height()/2),left:(d(window).width()/2)-(h.widgetContainer.width()/2)})}h.widgetContainer.show();h.firstShow=false}if(d("#ownWidget-slider").length>0){d("#ownWidget-slider").css({width:h.widgetContainer.width()-12});d("#ownWidget-slider > div").css({width:h.widgetContainer.width()-15});if(d("#ownWidget-slider > div").length>1){h.initMovingBox()}else{if(d("#ownWidget-slider").html()==""){d("#ownWidget-slider").html("<div>No images found!</div>");d("#SlideShowButton").hide()}}}if(d("a[rel=fancyArea]").length>0){d("a[rel=fancyArea]").fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:600,speedOut:200,titlePosition:"over",titleFormat:function(k,l,n,m){return'<span id="fancybox-title-over">Image '+(n+1)+" / "+l.length+" "+k+"</span>"}});d("#SlideShowButton").show()}}})},loadSuperSizedTheme:function(){d.supersized.themeVars={progress_delay:false,thumb_page:false,thumb_interval:false,image_path:this.options.path+this.options.appspath+"/files_sharing_widget/img/",play_button:"#pauseplay",next_slide:"#nextslide",prev_slide:"#prevslide",next_thumb:"#nextthumb",prev_thumb:"#prevthumb",slide_caption:"#slidecaption",slide_current:".slidenumber",slide_total:".totalslides",slide_list:"#slide-list",thumb_tray:"#thumb-tray",thumb_list:"#thumb-list",thumb_forward:"#thumb-forward",thumb_back:"#thumb-back",tray_arrow:"#tray-arrow",tray_button:"#tray-button",progress_bar:"#progress-bar"}},initSupersized:function(){var g=this;var h='<div id="slideshow-content" style="display:none;z-index:201;"><div id="closeSlideShow">X</div><div id="prevthumb"></div><div id="nextthumb"></div>	<a id="prevslide" class="load-item"></a>	<a id="nextslide" class="load-item"></a>	<div id="thumb-tray" class="load-item"><div id="thumb-back"></div><div id="thumb-forward"></div></div>	<div id="progress-back" class="load-item"><div id="progress-bar"></div></div><div id="controls-wrapper" class="load-item"><div id="controls"><a id="play-button"><img id="pauseplay" src="'+this.options.path+this.options.appspath+'/files_sharing_widget/img/pause.png" /></a><div id="slidecounter"><span class="slidenumber"></span><span class="totalslides"></span></div><div id="slidecaption"></div><a id="tray-button"><img id="tray-arrow" src="'+this.options.path+this.options.appspath+'/files_sharing_widget/img/button-tray-up.png" /></a><ul id="slide-list"></ul></div></div></div>';d(h).appendTo("body");d("#closeSlideShow").click(function(){if(d.supersized.vars.slideshow_interval){clearInterval(d.supersized.vars.slideshow_interval)}g.imageSlide=[];d("#supersized-holder").remove();d("#slideshow-content").animate({opacity:"toggle"});d("#thumb-list").remove();g.widgetContainer.animate({opacity:"toggle"})})},loadSupersized:function(){this.loadSuperSizedTheme();d.supersized({slideshow:1,autoplay:0,start_slide:1,stop_loop:0,random:0,slide_interval:3000,transition:6,transition_speed:1000,new_window:1,pause_hover:0,keyboard_nav:1,performance:1,image_protect:1,min_width:0,min_height:0,vertical_center:1,horizontal_center:1,fit_always:0,fit_portrait:1,fit_landscape:0,slide_links:false,new_window:false,thumb_links:1,thumbnail_navigation:0,slides:this.imageSlide,progress_bar:1,mouse_scrub:0})},loginToFacebookApp:function(){d("body").append('<div id="fb-root"></div>');d.getScript(document.location.protocol+"//connect.facebook.net/de_DE/all.js");window.fbAsyncInit=function(){FB.init({appId:this.options.fbAppid,status:true,cookie:true,xfbml:true})}}}})();